<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>controler</title>
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mycss.css">
    <link rel="stylesheet" href="css/table-rwd.css">

</head>

<body>

    <!-- s2 導覽列 -->
    <section id="s2">
        <nav class="navbar navbar-expand-lg navbar-light shadow-sm">
            <div class="container">
                <a class="navbar-brand text-success" href="project1216.html"><i class="fa-brands fa-pagelines fa-2x"></i> MiNi商店</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item"><a class="nav-link not-ready" href="#">關於我們</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">農產品專區</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item not-ready" href="#">水果</a></li>
                                <li><a class="dropdown-item not-ready" href="#">蔬菜</a></li>
                                <li><a class="dropdown-item not-ready" href="#">菇類</a></li>
                                <li><a class="dropdown-item not-ready" href="#">種苗</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item not-ready" href="#">其他</a></li>
                            </ul>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <span class="text-03 h3 me-2 d-none" id="s2_menber_span">
                            會員:<span class="text-03 fw-900 h2">xxx</span>
                        </span>
                        <button class="btn btn-danger me-2" id="s2_logoutbtn" data-bs-toggle="modal"
                            data-bs-target="#loginModal">登出</button>
                    </div>
                </div>
            </div>
        </nav>
    </section>

    <script src="js/axios.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.1.js"></script>
    <script src="js/sweetalert2@11.js"></script>
    <script>

        function checkLoginStatus() {

            let token = localStorage.getItem("uid");
            if (!token) {
                console.log("沒有token!");
            }

            axios.get("http://127.0.0.1:5000/api/me", {
                headers: { Authorization: `Bearer ${token}` }
            })
                .then(function (response) {
                    console.log(response);
                    //token驗證成功
                    setLoginUI(response.data.userName)

                })
                .catch(function (error) {
                    console.log(error);
                })
                .finally(function () {
                    //
                })
        }

        function setLoginUI(userName) {

            //顯示會員登錄訊息與登出按鈕
            $("#s2_menber_span").removeClass("d-none");
            $("#s2_menber_span").html(`會員: <span class="text-03 h3 me-2">${userName}</span>`);
        }

        $(function () {

            //登出按鈕監聽
            $("#s2_logoutbtn").on("click", function () {
                clearLoginUI();
                //清除localstorage
                localStorage.removeItem("uid");
                //清空欄位
                resetLoginForm();
            })
        })

    </script>
</body>

</html>